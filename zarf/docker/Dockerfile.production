FROM node:16 as ui-build
WORKDIR /webpack
COPY ./dashboard ./
RUN npm install -g npm@8.1
RUN npm i --legacy-peer-deps
ENV NODE_ENV=production
RUN npm run build

FROM debian:bullseye-slim as runner
WORKDIR /porter
COPY bin/app /porter/
COPY bin/migrate /porter/
COPY --from=ui-build /webpack/build /porter/static
